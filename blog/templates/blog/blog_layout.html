{% extends "base.html" %}

{% block additional_styles %}
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'blog/css/style.css' %}">
{% endblock %}

{% block content %}
<div class="centered-content">
    <div class="content-area">
        <div class="profile-banner">
            <div class="profile-banner-content">
                <div class="profile-avatar">
                    <img src="https://avatars.githubusercontent.com/u/48101971?v=4" alt="Justin Smethers profile">
                </div>
                <div class="profile-text">
                    <p class="profile-heading">I'm Justin.</p>
                    <p class="profile-description">This site will be a collection of notes, write-ups, projects, thought out posts, garbage, and occassional breakthroughs. Mostly about data.</p>
                </div>
            </div>
        </div>
        <div class="posts">
            {% if all_tags %}
            <div class="tag-filter" aria-label="Filter posts by tag">
                <p class="tag-filter__label">Filter by tag</p>
                <div class="tag-filter__buttons" role="group" aria-label="Available tags">
                    <button class="tag tag--filter tag--active" data-filter-tag="all" aria-pressed="true">All</button>
                    {% for tag in all_tags %}
                    <button class="tag tag--{{ tag }}" data-filter-tag="{{ tag }}" aria-pressed="false">{{ tag|upper }}</button>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            <ul class="post-list">
                {% for post in posts %}
                <li class="post-list-item" data-tags="{{ post.tags|join:',' }}">
                    <a href="{% url 'blog:blog_detail' post.post_name %}">
                        <div class="post-list-row">
                            <span class="post-date">{{ post.date_posted|date:"M d, Y" }}</span>
                            <div class="post-main-line">
                                <h2 class="post-list-title">{{ post.title }}</h2>
                                {% if post.description %}
                                <p class="post-list-blurb">{{ post.description }}</p>
                                {% endif %}
                            </div>
                            {% if post.tags %}
                            <div class="post-tags" aria-label="Tags">
                                <ul class="tag-list tag-list--compact">
                                    {% for tag in post.tags %}
                                    <li class="tag tag--{{ tag }}">{{ tag|upper }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}
                        </div>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
<script>
    (function() {
        const filterButtons = Array.from(document.querySelectorAll('[data-filter-tag]'));
        const postItems = Array.from(document.querySelectorAll('.post-list-item'));
        if (!filterButtons.length || !postItems.length) {
            return;
        }

        const setActive = (tag) => {
            filterButtons.forEach((button) => {
                const isActive = button.dataset.filterTag === tag;
                button.classList.toggle('tag--active', isActive);
                button.setAttribute('aria-pressed', isActive ? 'true' : 'false');
            });
        };

        const applyFilter = (tag) => {
            postItems.forEach((item) => {
                const tags = (item.dataset.tags || '').split(',').filter(Boolean);
                const shouldShow = tag === 'all' || tags.includes(tag);
                item.style.display = shouldShow ? '' : 'none';
            });
        };

        filterButtons.forEach((button) => {
            button.addEventListener('click', () => {
                const selectedTag = button.dataset.filterTag;
                setActive(selectedTag);
                applyFilter(selectedTag);
            });
        });

        setActive('all');
        applyFilter('all');
    })();
</script>
{% endblock %}
